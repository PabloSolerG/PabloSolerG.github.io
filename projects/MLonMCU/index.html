<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Machine Learning on Microcontrollers | Pablo Soler Garcia </title> <meta name="author" content="Pablo Soler Garcia"> <meta name="description" content="Real-Time Hand Detection on MAX78000"> <meta name="keywords" content="robotics, electrical-engineering, machine-learning"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%9A%80&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://pablosolerg.github.io/projects/MLonMCU/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Pablo</span> Soler Garcia </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">Projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Machine Learning on Microcontrollers</h1> <p class="post-description">Real-Time Hand Detection on MAX78000</p> </header> <article> <div style="text-align: center;margin-bottom: 20px"> <img src="/assets/img/MLonMCU/results_dataset.png" alt="header" style="width: 100%; max-width: 800px;"> </div> <hr> <p>Gesture-based interfaces have immense potential in VR/AR devices and household appliances, enabling more intuitive human-device interaction. However, implementing machine learning algorithms on microcontrollers presents unique challenges, particularly in minimizing power consumption, memory usage, and computational costs.</p> <p>This project aimed to develop an efficient and lightweight hand detection algorithm for use on a resource-constrained microcontroller board (MAX78000FTHR). By introducing quantization, pruning, and architecture optimization techniques, we achieved high accuracy while maintaining minimal memory and energy usage. This project was part of the course Machine Learning for Microcontrollers.</p> <p>ðŸ”¸ Authors: Pablo Soler, Miguel Cuba</p> <hr> <h3 id="implementation">Implementation</h3> <h4 id="hardware">Hardware</h4> <p>The project used the MAX78000FTHR evaluation kit, a microcontroller equipped with:</p> <div style="display: flex; align-items: center; justify-content: center; gap: 20px;"> <div style="flex: 1; max-width: 50%;"> <ul> <li>ARM Cortex-M4F (100 MHz)</li> <li>RISC-V Core (60 MHz)</li> <li>CNN Accelerator with 64 processors</li> <li>512 KB Flash (432 KB for weights)</li> <li>128 KB SRAM</li> <li>64x64 px Image Sensor</li> </ul> </div> <div style="flex: 1; max-width: 50%; text-align: center;"> <img src="/assets/img/MLonMCU/MAX7800.png" alt="MAX78000FTHR Board" style="width: 100%; max-width: 300px;"> <p style="font-size: 14px; color: gray;">MAX78000FTHR Board</p> </div> </div> <p>It is basically a microcontroller with a mini GPU. These features made it ideal for on-device deep learning tasks requiring low latency and power consumption.</p> <h4 id="dataset">Dataset</h4> <div style="text-align: center;margin-bottom: 20px"> <img src="/assets/img/MLonMCU/Egohands.png" alt="Egohands Dataset" style="width: 100%; max-width: 800px;"> </div> <p>We utilized the Egohands Dataset, the largest first-person hand dataset, with 15,000 labeled hands across 4,800 frames (720x1280px). The dataset was downscaled to 64x64px for compatibility with the image sensor. For data augmentation the following techniques were used to improve generalization:</p> <div style="display: flex; align-items: center; justify-content: center; gap: 20px;"> <div style="flex: 1; max-width: 50%;"> <ul> <li>Horizontal flips</li> <li>Color jitter (Hue, Brightness, Saturation)</li> <li>Random scaling</li> <li>Random shifts and cropping</li> </ul> </div> <div style="flex: 1; max-width: 50%; text-align: center;"> <img src="/assets/img/MLonMCU/data_augmentations.png" alt="Data Augmentations" style="width: 100%"> </div> </div> <h4 id="model-architecture">Model Architecture</h4> <p>The model was inspired by Tinyissimo YOLO, which we adapted slightly to fit into our boardâ€™s memory.</p> <div style="text-align: center;"> <img src="/assets/img/MLonMCU/tinyissimo.png" alt="Hand Detection Model" style="width: 90%;margin-bottom: 20px"> </div> <h3 id="post-processing">Post-Processing</h3> <p>The output format of the model is based on the YOLO grid-like cell output. As normal YOLO models, we filter low confidence boxes and then apply Non-Max Suppression (NMS) to overlapping boxes.</p> <div style="text-align: center;"> <img src="/assets/img/MLonMCU/post_processing.png" alt="Post Processing" style="width: 90%;margin-bottom: 20px"> </div> <h3 id="quantization-and-pruning">Quantization and Pruning</h3> <p>To increase the frames per second that the microcontroller can process, we pruned and quantized the network to different degrees to see which yielded the best balance between accuracy and efficiency. For pruning we tested structured L2 (layer specific) pruning and unstructured L1 pruning with pruning ratios from 0.1 to 0.5. We ended up going with a 8 and 4 Bit mixed precision quantization approach and pruning only the final convolutional layer with a pruning ratio of 0.2.</p> <div style="text-align: center;"> <img src="/assets/img/MLonMCU/results_MACCs.png" alt="Quantization" style="width: 90%;margin-bottom: 20px"> </div> <h3 id="results">Results</h3> <p>Our final model had an accuracy of 0.88 on the Egohands dataset needing only 412kB and 29M per inference. Image preprocessing took 6ms and running inference took 5.5ms, leading to over 60fps on the microcontrollerâ€™s camera sensor.</p> <div style="text-align: center;"> <img src="/assets/img/MLonMCU/results_final.png" alt="Final Results" style="width: 100%;margin-bottom: 20px"> </div> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> Â© Copyright 2024 Pablo Soler Garcia. Last updated: November 22, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> </body> </html>